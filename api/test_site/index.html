<!-- ...existing code... -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>File Count • Test</title>

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* small accent for glass card */
    .glass {
      background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.06);
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-sky-800 via-indigo-800 to-purple-700 text-slate-100 antialiased">
  <main class="min-h-screen flex items-center justify-center p-6">
    <section class="w-full max-w-2xl">
      <div class="glass rounded-2xl p-8 shadow-2xl">
        <div class="flex items-start gap-4">
          <div class="flex-1">
            <h1 class="text-3xl font-semibold tracking-tight">Get File Count</h1>
            <p class="mt-1 text-slate-300">Enter the unique text to query the server for files.</p>
          </div>

          <div class="flex items-center gap-3">
            <div class="text-slate-300 text-sm">Local API</div>
            <div class="text-xs px-2 py-1 rounded bg-white/10 text-slate-200">v1</div>
          </div>
        </div>

        <div class="mt-6 grid grid-cols-1 gap-4">
          <!-- input -->
          <div class="relative">
            <label for="unique_text" class="sr-only">Unique text</label>
            <div class="relative">
              <span class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                <!-- simple icon -->
                <svg class="w-5 h-5 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                  xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V7M7 7V5a5 5 0 0110 0v2" />
                </svg>
              </span>

              <input id="unique_text" type="text" placeholder="e.g. user_123_session" autocomplete="off"
                class="w-full pl-11 pr-28 py-3 rounded-xl bg-white/5 border border-white/6 text-slate-100 placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:border-transparent transition" />
              <button id="clear" title="Clear"
                class="absolute right-24 top-1/2 -translate-y-1/2 text-slate-300 hover:text-white px-3 py-1 rounded-md hidden">
                Clear
              </button>

              <div class="absolute right-2 top-1/2 -translate-y-1/2">
                <button id="submit"
                  class="flex items-center gap-2 bg-indigo-500 hover:bg-indigo-600 active:scale-95 transition text-white px-4 py-2 rounded-lg shadow">
                  <svg id="btnSpinner" class="w-4 h-4 hidden animate-spin" viewBox="0 0 24 24" fill="none"
                    xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="rgba(255,255,255,0.25)" stroke-width="4"></circle>
                    <path d="M22 12a10 10 0 00-10-10" stroke="currentColor" stroke-width="4" stroke-linecap="round"></path>
                  </svg>
                  <span id="btnText">Get Count</span>
                </button>
              </div>
            </div>
          </div>

          <!-- result card -->
          <div id="resultCard" class="mt-1 hidden p-4 rounded-lg bg-gradient-to-r from-white/6 to-white/3 border border-white/5">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-sm text-slate-300">Result</div>
                <div id="message" class="mt-1 text-lg font-medium text-slate-100">Waiting for query...</div>
              </div>

              <div class="text-right">
                <div id="count" class="text-4xl font-extrabold text-white leading-none">0</div>
                <div id="meta" class="text-xs text-slate-400 mt-1">—</div>
              </div>
            </div>
          </div>

          <p class="text-xs text-slate-300 mt-2">This uses the local API at <span class="font-mono">http://192.168.1.138:8000/get_file_count/</span></p>
        </div>
      </div>

      <footer class="mt-6 text-center text-xs text-slate-300">
        Tip: press Enter to submit · <span id="updatedAt">Not queried yet</span>
      </footer>
    </section>
  </main>

  <script>
    const uniqueInput = document.getElementById('unique_text');
    const submitBtn = document.getElementById('submit');
    const btnSpinner = document.getElementById('btnSpinner');
    const btnText = document.getElementById('btnText');
    const resultCard = document.getElementById('resultCard');
    const messageEl = document.getElementById('message');
    const countEl = document.getElementById('count');
    const metaEl = document.getElementById('meta');
    const updatedAt = document.getElementById('updatedAt');
    const clearBtn = document.getElementById('clear');

    uniqueInput.addEventListener('input', () => {
      clearBtn.classList.toggle('hidden', uniqueInput.value.trim().length === 0);
    });

    clearBtn.addEventListener('click', () => {
      uniqueInput.value = '';
      clearBtn.classList.add('hidden');
      uniqueInput.focus();
    });

    uniqueInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') submitBtn.click();
    });

    submitBtn.addEventListener('click', getFileCount);

    async function getFileCount() {
      const value = uniqueInput.value.trim();
      if (!value) {
        showError('Please enter unique text to query.');
        return;
      }

      setLoading(true);
      resultCard.classList.remove('hidden');
      messageEl.textContent = 'Querying server…';
      countEl.textContent = '0';
      metaEl.textContent = '…';

      const apiURL = `http://192.168.1.138:8000/get_file_count/?unique_text=${encodeURIComponent(value)}`;

      try {
        const resp = await fetch(apiURL, { cache: 'no-store' });
        const data = await resp.json();

        if (!data || data.status !== 'success') {
          const msg = data && data.message ? data.message : `Unexpected response (status ${resp.status})`;
          showError(msg);
          return;
        }

        messageEl.textContent = 'Success';
        animateCount(0, Number(data.file_count || 0), 800);
        metaEl.textContent = `queried for "${value}"`;
        updatedAt.textContent = `Last: ${new Date().toLocaleTimeString()}`;
      } catch (err) {
        console.error('Fetch error:', err);
        showError('Error fetching file count. See console for details.');
      } finally {
        setLoading(false);
      }
    }

    function setLoading(isLoading) {
      btnSpinner.classList.toggle('hidden', !isLoading);
      btnText.textContent = isLoading ? 'Loading…' : 'Get Count';
      submitBtn.disabled = isLoading;
      submitBtn.classList.toggle('opacity-60', isLoading);
    }

    function showError(msg) {
      messageEl.textContent = `Error: ${msg}`;
      messageEl.classList.add('text-amber-300');
      countEl.textContent = '—';
      metaEl.textContent = '';
      updatedAt.textContent = `Last: ${new Date().toLocaleTimeString()}`;
      resultCard.classList.remove('hidden');
    }

    // smooth number increment
    function animateCount(start, end, duration) {
      const range = end - start;
      const startTime = performance.now();

      function step(now) {
        const elapsed = now - startTime;
        const t = Math.min(1, elapsed / duration);
        const ease = t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t; // easeInOutQuad approx
        const current = Math.round(start + ease * range);
        countEl.textContent = current.toLocaleString();
        if (t < 1) {
          requestAnimationFrame(step);
        } else {
          countEl.textContent = end.toLocaleString();
        }
      }

      requestAnimationFrame(step);
    }
  </script>
</body>

</html>